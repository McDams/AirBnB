---
title: "AirBnB"
format: html
editor: visual
---

## 1. Chargement des librairies

```{r}
library(readr)
library(tidyverse)  # Manipulation et Visualisation
library(lubridate)  
library(skimr)      # Statistique
```

## 2. Importation des données

## 2.1 Paris
## 2.1.1 Listings

```{r}
listings_paris <- read_csv("../data/paris/listings.csv")
```

## 2.1.2 Affichage des premières lignes
```{r}
head(listings_paris)
```
## 2.1.3 Suppression des doublons
```{r}
listings_paris <- listings_paris %>%
  distinct()
```

## 2.1.4 Statistiques descriptives
```{r}
skim(listings_paris)
```

## 2.2 Bordeaux
## 2.2.1 Listings
```{r}
listings_bordeaux <- read_csv("../data/bordeaux/listings.csv")
```

## 2.2.2 Affichage des premières lignes
```{r}
head(listings_bordeaux)
```
## 2.2.3 Suppression des doublons
```{r}
listings_bordeaux <- listings_bordeaux %>%
  distinct()
```

## 2.2.4 Statistiques descriptives
```{r}
skim(listings_bordeaux)
```
## 2.3 Lyon
## 2.3.1 Listings
```{r}
listings_lyon <- read_csv("../data/lyon/listings.csv")
```

## 2.3.2 Affichage des premières lignes
```{r}
head(listings_lyon)
```
## 2.3.3 Suppression des doublons
```{r}
listings_lyon <- listings_lyon %>%
  distinct()
```

## 2.3.4 Statistiques descriptives
```{r}
skim(listings_lyon)
```

## 3. Nettoyage des données
## 3.1 Paris
## 3.1.1 Listings - Suppression des colonnes inutiles
```{r}
# Suppression de la colonne licence
listings_paris <- listings_paris %>%
  select(-license)

# Suppression de la colonne neighbourhood_group
listings_paris <- listings_paris %>%
  select(-neighbourhood_group)

# Vérification
head(listings_paris)
```
## 3.1.2 Listings - Remplacement les valeurs NA dans la colonne price
```{r}
# Remplacement des valeurs NA dans la colonne price par la moyenne des prix
mean_price_paris <- mean(listings_paris$price, na.rm = TRUE)
listings_paris <- listings_paris %>%
  mutate(price = ifelse(is.na(price), mean_price_paris, price))

# Vérification
head(listings_paris)
```

## 3.2 Bordeaux
## 3.2.1 Listings - Suppression des colonnes inutiles
```{r}
# Suppression de la colonne licence
listings_bordeaux <- listings_bordeaux %>%
  select(-license)

# Suppression de la colonne neighbourhood_group
listings_bordeaux <- listings_bordeaux %>%
  select(-neighbourhood_group)

# Vérification
head(listings_bordeaux)
```

3.2.2 Remplacement des valeurs NA dans la colonne price
```{r}
# Remplacement des valeurs NA dans la colonne price par la moyenne des prix
mean_price_bordeaux <- mean(listings_bordeaux$price, na.rm = TRUE)
listings_bordeaux <- listings_bordeaux %>%
  mutate(price = ifelse(is.na(price), mean_price_bordeaux, price))

# Vérification
head(listings_bordeaux)
```

## 3.3 Lyon
## 3.3.1 Listings - Suppression des colonnes inutiles
```{r}
# Suppression de la colonne licence
listings_lyon <- listings_lyon %>%
  select(-license)

# Suppression de la colonne neighbourhood_group
listings_lyon <- listings_lyon %>%
  select(-neighbourhood_group)

# Vérification
head(listings_lyon)
```
## 3.3.2 Listings - Remplacement des valeurs NA dans la colonne price
```{r}
# Remplacement des valeurs NA dans la colonne price par la moyenne des prix
mean_price_lyon <- mean(listings_lyon$price, na.rm = TRUE)
listings_lyon <- listings_lyon %>%
  mutate(price = ifelse(is.na(price), mean_price_lyon, price))

# Vérification
head(listings_lyon)
```

## 4. Sauvegarde des données nettoyées
```{r}
write_csv(listings_paris, "../data_cleaned/paris/listings_cleaned.csv")
write_csv(listings_bordeaux, "../data_cleaned/bordeaux/listings_cleaned.csv")
write_csv(listings_lyon, "../data_cleaned/lyon/listings_cleaned.csv")
```

## 5. Renommer les fichiers nettoyés
```{r}
file.rename("../data_cleaned/paris/listings_cleaned.csv", "../data_cleaned/paris/listings_paris_cleaned.csv")
file.rename("../data_cleaned/bordeaux/listings_cleaned.csv", "../data_cleaned/bordeaux/listings_bordeaux_cleaned.csv")
file.rename("../data_cleaned/lyon/listings_cleaned.csv", "../data_cleaned/lyon/listings_lyon_cleaned.csv")
```

````{r}
listings_paris <- read_csv("../data_cleaned/paris/listings_paris_cleaned.csv")
listings_bordeaux <- read_csv("../data_cleaned/bordeaux/listings_bordeaux_cleaned.csv")
listings_lyon <- read_csv("../data_cleaned/lyon/listings_lyon_cleaned.csv")
````

## 6. Analyse exploratoire des données (EDA)
## 6.1 Visualisation Globale des datasets

## 6.1.1 Nombre total d'annonces par ville
```{r}
library(tibble)
library(ggplot2)

# Créer un tableau avec le nombre total d'annonces par ville
total_listings <- tibble(
  ville = c("Paris", "Bordeaux", "Lyon"),
  nombre_annonces = c(nrow(listings_paris), nrow(listings_bordeaux), nrow(listings_lyon))
)
# Ajouter une colonne pour la proportion par ville
total_listings <- total_listings %>%
  mutate(proportion = round((nombre_annonces / sum(nombre_annonces)) * 100, 2))

# Afficher le tableau
print(total_listings)

```

## 6.1.2 Visualiser le nombre total d'annonces par ville (Affichage avec les nombres )
## 6.1.2.1 Graphique en barres
```{r}
ggplot(total_listings, aes(x = ville, y = nombre_annonces, fill = ville)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = nombre_annonces), vjust = -0.5) +
  labs(title = "Nombre total d'annonces AirBnB par ville",
       x = "Villes",
       y = "Nombre d'annonces") +
  theme_minimal()

# Sauvegarder le graphique
ggsave("../images/total_listings_by_city.png")
```

## 6.1.2.2 Pie chart: Repartition Bordeaux, Lyon, Paris
```{r}
library(ggplot2)

# Créer un pie chart pour la répartition des annonces par ville
ggplot(total_listings, aes(x = "", y = nombre_annonces, fill = ville)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(proportion, "%")), 
            position = position_stack(vjust = 0.5)) +
  labs(title = "Répartition des annonces AirBnB par ville") +
  theme_void()

# Sauvegarder le graphique
ggsave("../images/pie_chart_listings_by_city.png")
```

## 6.2 Analyse des prix des annonces
## 6.2.1 Prix moyen, médian, min, max;
```{r}
price_summary <- function(data, city_name) {
  summary <- data %>%
    summarise(
      ville = city_name,
      prix_moyen = mean(price, na.rm = TRUE),
      prix_median = median(price, na.rm = TRUE),
      prix_min = min(price, na.rm = TRUE),
      prix_max = max(price, na.rm = TRUE)
    )
  return(summary)
}
summary_paris <- price_summary(listings_paris, "Paris")
summary_bordeaux <- price_summary(listings_bordeaux, "Bordeaux")
summary_lyon <- price_summary(listings_lyon, "Lyon")
price_summaries <- bind_rows(summary_paris, summary_bordeaux, summary_lyon)
print(price_summaries)

# Sauvegarder le tableau des résumés de prix
write_csv(price_summaries, "../data_cleaned/price_summaries.csv")
```

## 6.2.2 Visualisation des prix moyens par ville
```{r}
ggplot(price_summaries, aes(x = ville, y = prix_moyen, fill = ville)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(prix_moyen, 2)), vjust = -0.5) +
  labs(title = "Prix moyen des annonces AirBnB par ville",
       x = "Villes",
       y = "Prix moyen (€)") +
  theme_minimal()
# Sauvegarder le graphique
ggsave("../images/average_price_by_city.png")
```

## 6.2.3 Distribution des prix (1 histogramme par facetté)

```{r}
listings_paris <- listings_paris %>%
  mutate(ville = "Paris")
listings_bordeaux <- listings_bordeaux %>%
  mutate(ville = "Bordeaux")
listings_lyon <- listings_lyon %>%
  mutate(ville = "Lyon")
all_listings <- bind_rows(listings_paris, listings_bordeaux, listings_lyon)
ggplot(all_listings, aes(x = price, fill = ville)) +
  geom_histogram(binwidth = 20, position = "dodge", alpha = 0.7) +
  facet_wrap(~ ville) +
  labs(title = "Distribution des prix des annonces AirBnB par ville",
       x = "Prix (€)",
       y = "Nombre d'annonces") +
  theme_minimal()

# Sauvegarder le graphique
ggsave("../images/price_distribution_by_city.png")
```

## 6.3 Analyse des types de logements
## 6.3.1 Répartition des types de logements par ville
```{r}
type_summary <- function(data, city_name) {
  summary <- data %>%
    group_by(room_type) %>%
    summarise(nombre_annonces = n()) %>%
    mutate(ville = city_name)
  return(summary)
}
summary_paris <- type_summary(listings_paris, "Paris")
summary_bordeaux <- type_summary(listings_bordeaux, "Bordeaux")
summary_lyon <- type_summary(listings_lyon, "Lyon")
type_summaries <- bind_rows(summary_paris, summary_bordeaux, summary_lyon)
print(type_summaries)

# Sauvegarder le tableau des résumés de types de logements
write_csv(type_summaries, "../data_cleaned/type_summaries.csv")
```
## 6.3.2 Visualisation de la répartition des types de logements par ville
```{r}
ggplot(type_summaries, aes(x = room_type, y = nombre_annonces, fill = room_type)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ ville) +
  geom_text(aes(label = nombre_annonces), vjust = -0.5) +
  labs(title = "Répartition des types de logements AirBnB par ville",
       x = "Type de logement",
       y = "Nombre d'annonces") +
  theme_minimal()
# Sauvegarder le graphique
ggsave("../images/room_type_distribution_by_city.png")
```

## 6.3.3 Prix par type de logement et par ville
## 6.3.3.A. Tableau récapitulatif
```{r}
price_by_type_summary <- function(data, city_name) {
  summary <- data %>%
    group_by(room_type) %>%
    summarise(
      prix_moyen = mean(price, na.rm = TRUE),
      prix_median = median(price, na.rm = TRUE)
    ) %>%
    mutate(ville = city_name)
  return(summary)
}
summary_paris <- price_by_type_summary(listings_paris, "Paris")
summary_bordeaux <- price_by_type_summary(listings_bordeaux, "Bordeaux")
summary_lyon <- price_by_type_summary(listings_lyon, "Lyon")
price_by_type_summaries <- bind_rows(summary_paris, summary_bordeaux, summary_lyon)
print(price_by_type_summaries)

# Sauvegarder le tableau des résumés de prix par type de logement
write_csv(price_by_type_summaries, "../data_cleaned/price_by_type_summaries.csv")
```

## 6.3.3.B. Visualisation
```{r}
ggplot(price_by_type_summaries, aes(x = room_type, y = prix_moyen, fill = room_type)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ ville) +
  geom_text(aes(label = round(prix_moyen, 2)), vjust = -0.5) +
  labs(title = "Prix moyen des annonces AirBnB par type de logement et par ville",
       x = "Type de logement",
       y = "Prix moyen (€)") +
  theme_minimal()

# Sauvegarder le graphique
ggsave("../images/average_price_by_room_type_and_city.png")
```





































































